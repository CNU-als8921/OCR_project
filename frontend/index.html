<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>손글씨 숫자/문자 인식</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #canvas { border: 2px solid #333; background: #fff; cursor: crosshair; }
    #result { margin-top: 20px; font-size: 1.2em; }
    #controls { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>손글씨 입력 (28x28 픽셀로 변환)</h2>
  <canvas id="canvas" width="280" height="280"></canvas>
  <div id="controls">
    <button onclick="clearCanvas()">지우기</button>
    <button onclick="sendImage()">서버로 전송</button>
  </div>
  <div id="result"></div>

  <script>
    // 캔버스 그리기
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    canvas.addEventListener('mousedown', e => { drawing = true; });
    canvas.addEventListener('mouseup', e => { drawing = false; ctx.beginPath(); });
    canvas.addEventListener('mouseout', e => { drawing = false; ctx.beginPath(); });
    canvas.addEventListener('mousemove', draw);

    function draw(e) {
      if (!drawing) return;
      ctx.lineWidth = 20;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#000';
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    }

    function clearCanvas() {
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      document.getElementById('result').innerText = '';
    }

    window.onload = clearCanvas;

    function sendImage() {
      // 1. 28x28로 리사이즈
      const smallCanvas = document.createElement('canvas');
      smallCanvas.width = 28;
      smallCanvas.height = 28;
      const smallCtx = smallCanvas.getContext('2d');
      // 흰색 배경으로 초기화
      smallCtx.fillStyle = "#fff";
      smallCtx.fillRect(0, 0, 28, 28);
      smallCtx.drawImage(canvas, 0, 0, 28, 28);

      // 2. PNG로 변환
      smallCanvas.toBlob(blob => {
        const formData = new FormData();
        formData.append('file', blob, 'drawn.png');

        // 3. 서버로 전송
        fetch('http://localhost:8000/predict', {
          method: 'POST',
          body: formData
        })
        .then(res => res.json())
        .then(data => {
          document.getElementById('result').innerText =
            data.error
              ? '오류: ' + data.error
              : `예측 클래스: ${data.class}\n신뢰도: ${data.confidence.toFixed(3)}`;
        })
        .catch(err => {
          document.getElementById('result').innerText = '서버 오류: ' + err;
        });
      }, 'image/png');
    }
  </script>
</body>
</html> 